{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "mlflow-tracking-server Chart values schema",
  "description": "Schema for values.yaml of the mlflow-tracking-server Helm chart",
  "type": "object",
  "properties": {
    "fullnameOverride": { "type": ["string", "null"], "description": "Optional full name override for the chart" },

    "replicas": {
      "type": "integer",
      "minimum": 0,
      "default": 1,
      "description": "Number of pod replicas for the Deployment"
    },

    "hpa": {
      "type": "object",
      "description": "Horizontal Pod Autoscaler options",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "minReplicas": { "type": "integer", "minimum": 1, "default": 2 },
        "maxReplicas": { "type": "integer", "minimum": 1, "default": 5 },
        "targetCPUUtilizationPercentage": { "type": "integer", "minimum": 1, "maximum": 100, "default": 80 }
      },
      "additionalProperties": false
    },

    "image": {
      "type": "object",
      "description": "Container image settings",
      "properties": {
        "pullSecretsEnabled": { "type": "boolean", "default": false, "description": "Whether to use imagePullSecrets (ArgoCD values include this)" },
        "registry": { "type": "string", "default": "ghcr.io/mlflow-oidc" },
        "name": { "type": "string", "default": "mlflow-tracking-server" },
        "tag": { "type": "string", "default": "latest" },
        "pullPolicy": { "type": "string", "enum": ["IfNotPresent", "Always", "Never"], "default": "IfNotPresent" }
      },
      "additionalProperties": true
    },

    "config": {
      "type": "object",
      "description": "Configuration values rendered into the server ConfigMap (env-style)",
      "properties": {
        "data": {
          "type": "object",
          "description": "Key/value pairs for server config and environment variables (accepts arbitrary keys)",
          "properties": {
            "MLFLOW_HOST": { "type": "string", "default": "0.0.0.0" },
            "MLFLOW_PORT": { "type": "string", "default": "8080" },
            "MLFLOW_DEFAULT_ARTIFACT_ROOT": { "type": "string", "default": "mlflow-artifacts:/" },
            "MLFLOW_SERVE_ARTIFACTS": { "type": "string", "default": "true" },
            "MLFLOW_ARTIFACTS_DESTINATION": { "type": "string", "default": "/mlflow-data" },
            "MLFLOW_SERVER_ALLOWED_HOSTS": { "type": ["string", "null"], "default": null },
            "MLFLOW_UVICORN_OPTS": { "type": ["string", "null"], "default": null },
            "MLFLOW_S3_ENDPOINT_URL": { "type": ["string", "null"], "default": null },
            "MLFLOW_S3_IGNORE_TLS": { "type": ["boolean", "string", "null"], "default": null },
            "OIDC_DISCOVERY_URL": { "type": "string", "default": "https://your-oidc-provider/.well-known/openid-configuration" },
            "OIDC_PROVIDER_DISPLAY_NAME": { "type": "string", "default": "Sign in with OIDC" },
            "OIDC_SCOPE": { "type": "string", "default": "openid,profile,email,groups" },
            "OIDC_GROUPS_ATTRIBUTE": { "type": "string", "default": "groups" },
            "OIDC_REDIRECT_URI": { "type": ["string", "null"], "default": null },
            "OIDC_GROUP_NAME": { "type": "string", "default": "mlflow-users" },
            "OIDC_ADMIN_GROUP_NAME": { "type": "string", "default": "mlflow-admins" },
            "DEFAULT_MLFLOW_PERMISSION": { "type": "string", "default": "MANAGE" },
            "PERMISSION_SOURCE_ORDER": { "type": ["string", "null"], "default": null },
            "OIDC_GROUP_DETECTION_PLUGIN": { "type": ["string", "null"], "default": null },
            "EXTEND_MLFLOW_MENU": { "type": "string", "default": "true" },
            "DEFAULT_LANDING_PAGE_IS_PERMISSIONS": { "type": "string", "default": "true" },
            "AUTOMATIC_LOGIN_REDIRECT": { "type": "string", "default": "false" },
            "OIDC_ALEMBIC_VERSION_TABLE": { "type": "string", "default": "alembic_version" },
            "LOG_LEVEL": { "type": "string", "default": "INFO" }
          },
          "patternProperties": {
            "^.*$": { "type": ["string", "boolean", "number", "array", "object", "null"] }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "secrets": {
      "type": "object",
      "description": "External secret configuration",
      "properties": {
        "externalSecretName": { "type": "string", "default": "" },
        "mountAsFiles": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": false },
            "path": { "type": "string", "default": "/var/run/secrets/mlflow-oidc-auth" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": { "type": "boolean", "default": false },
        "annotations": { "type": "object", "additionalProperties": { "type": "string" } },
        "name": { "type": ["string", "null"], "default": null }
      },
      "additionalProperties": false
    },

    "sharedConfigs": { "type": "array", "items": { "type": "string" } },
    "sharedSecrets": { "type": "array", "items": { "type": "string" } },

    "resources": {
      "type": "object",
      "description": "Kubernetes resource requests and limits",
      "properties": {
        "limits": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          },
          "additionalProperties": false
        },
        "requests": {
          "type": "object",
          "properties": {
            "cpu": { "type": "string" },
            "memory": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "healthCheck": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "liveness": { "type": "object", "properties": { "path": { "type": "string", "default": "health/live" } }, "additionalProperties": false },
        "readiness": { "type": "object", "properties": { "path": { "type": "string", "default": "health/ready" } }, "additionalProperties": false },
        "startup": { "type": "object", "properties": { "path": { "type": "string", "default": "health/ready" } }, "additionalProperties": false }
      },
      "additionalProperties": false
    },

    "securityContext": {
      "type": "object",
      "properties": {
        "runAsUser": { "type": "integer", "default": 1000 },
        "runAsGroup": { "type": "integer", "default": 1000 },
        "fsGroup": { "type": "integer", "default": 1000 }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
